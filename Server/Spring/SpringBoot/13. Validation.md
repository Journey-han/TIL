# 01. Spring Boot Validation

- Validationì´ë€ í”„ë¡œê·¸ë˜ë°ì— ìˆì–´ì„œ ê°€ì¥ í•„ìš”í•œ ë¶€ë¶„ì´ë‹¤. 
- íŠ¹íˆ Javaì—ì„œëŠ” null ê°’ì— ëŒ€í•´ì„œ ì ‘ê·¼í•˜ë ¤ê³  í•  ë•Œ `null pointer exceptionì´`ë°œìƒ í•¨ìœ¼ë¡œ, ì´ëŸ¬í•œ ë¶€ë¶„ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ ë¯¸ë¦¬ ê²€ì¦ì„ í•˜ëŠ” ê³¼ì •ì„ Validationì´ë¼ê³  í•œë‹¤.

### ë‹¨ìˆœí•œ ì½”ë“œ

```java
public void run(String account, String pw, int age) {
	if (account == null || pw == null) {
		return
	}
	if (age == 0) {
		return
	}

	// ì •ìƒ Logic
}
```

## ë¬¸ì œì 

1. ê²€ì¦í•´ì•¼ í•  ê°’ì´ ë§ì€ ê²½ìš° ì½”ë“œì˜ ê¸¸ì´ê°€ ê¸¸ì–´ì§„ë‹¤.
2. êµ¬í˜„ì— ë”°ë¼ì„œ ë‹¬ë¼ ì§ˆ ìˆ˜ ìˆì§€ë§Œ Service Logicê³¼ì˜ ë¶„ë¦¬ê°€ í•„ìš”í•˜ë‹¤.
3. í©ì–´ì ¸ ìˆëŠ” ê²½ìš° ì–´ë””ì—ì„œ ê²€ì¦ì„ í•˜ëŠ”ì§€ ì•Œê¸° ì–´ë ¤ìš°ë©°, ì¬ì‚¬ìš©ì˜ í•œê³„ê°€ ìˆë‹¤.
4. êµ¬í˜„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì§€ë§Œ, ê²€ì¦ Logicì´ ë³€ê²½ë˜ëŠ” ê²½ìš° í…ŒìŠ¤íŠ¸ ì½”ë“œ ë“± ì°¸ì¡°í•˜ëŠ” í´ë˜ìŠ¤ì—ì„œ Logicì´ ë³€ê²½ë˜ì–´ì•¼ í•˜ëŠ” ë¶€ë¶„ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

## Annotations

| Annotation | ì˜ë¯¸ | ê¸°íƒ€ |
| --- | --- | --- |
| @Size | ë¬¸ì ê¸¸ì´ ì¸¡ì • | Int Type ë¶ˆê°€ |
| @Notnull | null ë¶ˆê°€ |  |
| @NotEmpty | null, â€œâ€ ë¶ˆê°€ |  |
| @NotBlank | null, â€œâ€, â€œ â€œ ë¶ˆê°€ |  |
| @Past | ê³¼ê±° ë‚ ì§œ |  |
| @PastOrPresent | ì˜¤ëŠ˜ì´ê±°ë‚˜ ê³¼ê±° ë‚ ì§œ |  |
| @Future | ë¯¸ë˜ ë‚ ì§œ |  |
| @FutureOrPresent | ì˜¤ëŠ˜ì´ê±°ë‚˜ ë¯¸ë˜ ë‚ ì§œ |  |
| @Pattern | ì •ê·œì‹ ì ìš© |  |
| @Max | ìµœëŒ€ê°’ |  |
| @Min | ìµœì†Œê°’ |  |
| @AssertTrue / False | ë³„ë„ Logic ì ìš© |  |
| @Valid | í•´ë‹¹ object validation ì‹¤í–‰ |  |

## Validation ì‚¬ìš©í•˜ê¸°

1. Gradle dependencies
    - `implementation 'org.springframework.boot:spring-boot-starter-validation'`
2. bean validation spec
    - [https://beanvalidation.org./2.0-jsr380/](https://beanvalidation.org./2.0-jsr380/)
3. í•¸ë“œí°ë²ˆí˜¸ ì •ê·œì‹
    - ^\\d{2,3}-\\d{3,4}-\\d{4}\$

## ì˜ˆì œ ì½”ë“œ

- User

```java
public class User {

    private String name;
    private int age;
    private String email;
	  private String phoneNumber;

    ... getter / setter ....

    @Override
    public String toString() {
        return "User{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", email='" + email + '\'' +
                ", phoneNumber=" + phoneNumber + '\'' +
                '}';
    }
}
```

- Controller

```java
@RestController
@RequestMapping("/api")
public class ApiController {

    @PostMapping("/user")
    public User user(@RequestBody User user) {
        System.out.println(user);

        return user;
    }
}
```

- Result

![á„‰á…³1.png](https://t1.daumcdn.net/cafeattach/1Dzpp/16c6cd521a1d372b51937887eee727e2f6bf868b)

### Validation

- Controller

```java
import com.example.validation.dto.User;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.validation.BindingResult;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.validation.Valid;

@RestController
@RequestMapping("/api")
public class ApiController {

    @PostMapping("/user")
                                                    // Validationì— ëŒ€í•œ ê²°ê³¼ê°€ ë°”ë¡œ ì—ëŸ¬ê°€ í„°ì§€ì§€ ì•Šê³  bindingResultë¡œ ê°’ì´ ë“¤ì–´ì˜¨ë‹¤.
    public ResponseEntity user(@Valid @RequestBody User user, BindingResult bindingResult) {

        if (bindingResult.hasErrors()) {
            StringBuilder sb = new StringBuilder();
            bindingResult.getAllErrors().forEach(objectError -> {
                // ì–´ë–¤ í•„ë“œì—ì„œ ì–´ë–¤ ì—ëŸ¬ê°€ ë‚¬ëŠ”ì§€ ê°’ ê°€ì ¸ì˜¤ê¸°.
                FieldError field = (FieldError) objectError;
                // ë©”ì„¸ì§€ ê°€ì ¸ì˜¤ê¸°
                String message = objectError.getDefaultMessage();

                System.out.println("field : " + field.getField());
                System.out.println("message : " + message);

                sb.append("field : " + field.getField());
                sb.append("message : " + message);
            });
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(sb.toString());
        }

        // logic

        return ResponseEntity.ok(user);
    }
}
```

### Validation ì—ëŸ¬ ë³´ê¸°

- Console ì°½ ê²°ê³¼

![á„‰á…³5.png](https://t1.daumcdn.net/cafeattach/1Dzpp/b918cd895e99c56fcc307ebb55467bf2134102a8)

- 1. ì´ë©”ì¼ í˜•ì‹ì´ â€˜asdf@hjklâ€™ì´ ì•„ë‹ ë•Œ

```java
WARN 1334 --- [nio-9090-exec-1] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity com.example.validation.controller.ApiController.user(com.example.validation.dto.User): [Field error in object 'user' on field 'email': rejected value [zzanggu]; codes [Email.user.email,Email.email,Email.java.lang.String,Email]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [user.email,email]; arguments []; default message [email],[Ljavax.validation.constraints.Pattern$Flag;@35bf8bdf,.*]; default message [ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ì´ë©”ì¼ ì£¼ì†Œì—¬ì•¼ í•©ë‹ˆë‹¤]] ]
```

- 2. í•¸ë“œí°ë²ˆí˜¸ í˜•ì‹ì´ â€˜xxx-xxxx-xxxxâ€™ì´ ì•„ë‹ ë•Œ

```java
WARN 1405 --- [nio-9090-exec-1] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity com.example.validation.controller.ApiController.user(com.example.validation.dto.User): [Field error in object 'user' on field 'phoneNumber': rejected value [01012345678]; codes [Pattern.user.phoneNumber,Pattern.phoneNumber,Pattern.java.lang.String,Pattern]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [user.phoneNumber,phoneNumber]; arguments []; default message [phoneNumber],[Ljavax.validation.constraints.Pattern$Flag;@34f826d2,^\d{2,3}-\d{3,4}-\d{4}$]; default message ["^\d{2,3}-\d{3,4}-\d{4}$"ì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤]] ]
```

- API ê²°ê³¼

![á„‰á…³3.png](https://t1.daumcdn.net/cafeattach/1Dzpp/f168aab6ee0e51890b2cc62448c446c6e5f9e737)


# 02. Customer Validation
- ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ Validationì„ ì»¤ìŠ¤í…€í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

- User

```java
.....

@Size(min = 6, max = 6)
private String reqYearMonth;    // yyyyMM

.....
```

- ì‹¤íŒ¨ ì‹œ API result

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-27 á„‹á…©á„Œá…¥á†« 3.46.06.png](https://t1.daumcdn.net/cafeattach/1Dzpp/1b4a174f7eccd3e979bb9ae8f0b165ffab6b0764)

- ì„±ê³µ ì‹œ API result

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-27 á„‹á…©á„Œá…¥á†« 3.48.18.png](https://t1.daumcdn.net/cafeattach/1Dzpp/e8ece973e64147363799d45da769e5e7fdcafd44)

- í•˜ì§€ë§Œ ì•„ë¬´ 6ê¸€ìë¥¼ ë„£ì–´ë„ í†µê³¼ê°€ ëœë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-27 á„‹á…©á„Œá…¥á†« 3.55.05.png](https://t1.daumcdn.net/cafeattach/1Dzpp/04b875ae6c770d47323bde1154269eef227d32cd)

## 1. AssertTrue / Falseì™€ ê°™ì€ Method ì§€ì •ì„ í†µí•´ì„œ Custom Logic ì ìš© ê°€ëŠ¥

- User

```java
....

@AssertTrue (message = "yyyyMMì˜ í˜•ì‹ì— ë§ì§€ ì•ŠìŠµë‹ˆë‹¤!")
public boolean isReqYearMonthValidation() {

  try {

	  LocalDate localDate = LocalDate.parse(getReqYearMonth() + "01", DateTimeFormatter.ofPattern("yyyyMMdd"));

  } catch (Exception e) {
    return false;
  }

	return true;
}

....
```

- API result
    - **ì‹¤íŒ¨ ì‹œ**
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-27 á„‹á…©á„Œá…¥á†« 4.01.46.png](https://t1.daumcdn.net/cafeattach/1Dzpp/fb6beaf1e81bdf301634346806fe6831e79cb196)
    
    - **ì„±ê³µ ì‹œ**
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-27 á„‹á…©á„Œá…¥á†« 4.03.32.png](https://t1.daumcdn.net/cafeattach/1Dzpp/3485dbc81a178376fd04f6828e88ffe8f117d9e7)
    

## 2. ConstraintValidatiorë¥¼ ì ìš©í•˜ì—¬ ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•œ Custom Logic ì ìš© ê°€ëŠ¥

### 01) Custom Validation ë§Œë“¤ê¸°

- @YearMonth

```java
package com.example.validation.annotation;

import com.example.validation.validator.YearMonthValidator;

import javax.validation.Constraint;
import javax.validation.Payload;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.*;
import static java.lang.annotation.ElementType.TYPE_USE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

// ì–´ë–¤ í´ë˜ìŠ¤ë¥¼ ë„˜ê²¨ì„œ ê²€ì‚¬í•  ê²ƒì´ëƒ?
@Constraint(validatedBy = {YearMonthValidator.class})
@Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })
@Retention(RUNTIME)
public @interface YearMonth {

    String message() default "yyyyMMì˜ í˜•ì‹ì— ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.";

    Class<?>[] groups() default { };

    Class<? extends Payload>[] payload() default { };

    // ì‚¬ìš©ìê°€ íŒ¨í„´ì„ ë”°ë¡œ ì§€ì •í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ê¸°ë³¸ íŒ¨í„´ì„ ê°€ì§„ë‹¤.
    String pattern() default "yyyyMMdd";
}
```

- YearMonthValidator

```java
package com.example.validation.validator;

import com.example.validation.annotation.YearMonth;

import javax.validation.ConstraintValidator;
import javax.validation.ConstraintValidatorContext;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;

// ì´ í´ë˜ìŠ¤ë¥´ í†µí•´ì„œ ê²€ì‚¬ê°€ ì´ë£¨ì–´ì§„ë‹¤.
public class YearMonthValidator implements ConstraintValidator<YearMonth, String> {

    // ì´ˆê¸°í™”
    private String pattern;

    // ì´ˆê¸°í™” í–ˆì„ ë•Œ ì–´ë…¸í…Œì´ì…˜ì´ ì§€ì •ëœ íŒ¨í„´ì„ ê°€ì§€ê²Œëœë‹¤.
    @Override
    public void initialize(YearMonth constraintAnnotation) {
        this.pattern = constraintAnnotation.pattern();
    }

    // íŒ¨í„´ì´ ì˜ ì§€ì •ëëŠ”ì§€ ê²€ì‚¬í•œë‹¤. íŒ¨í„´ì´ ì§€ì •ëœ valueê°’ì´ ì˜ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸í•œë‹¤.
    @Override
    public boolean isValid(String value, ConstraintValidatorContext context) {

        // yyyyMM01
        try {

            LocalDate localDate = LocalDate.parse(value + "01", DateTimeFormatter.ofPattern(this.pattern));

        } catch (Exception e) {
            return false;
        }

        return true;
    }
}
```

- User

```java
import com.example.validation.annotation.YearMonth;

public class User {

.....

    // ì‚¬ìš©ìê°€ íŒ¨í„´ì„ ì§€ì •í•˜ëŠ” ê²ƒ. íŒ¨í„´ ì§€ì • ì•ˆí•˜ê³  ì–´ë…¸í…Œì´ì…˜ë§Œ ë¶™ì¼ ê²½ìš° ê¸°ë³¸ íŒ¨í„´ì„ ê°€ì§„ë‹¤.
    // @YearMonth(pattern = "yyMM")
    @YearMonth
    private String reqYearMonth;

...getter / setter...

}
```

- API Result
    - **ğŸ’¡Â `yyyyMM`í˜•ì‹ì¸ `202202`ìœ¼ë¡œ ì…ë ¥í•˜ë©´ ì„±ê³µí•  ê²ƒì´ë‹¤.**

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-27 á„‹á…©á„’á…® 3.35.59.png](https://t1.daumcdn.net/cafeattach/1Dzpp/dada4b600dc037e991b6a96c79bc20cf90e1792d)

### 02) ê°ì²´ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ê¸°

- Car

```java
import com.fasterxml.jackson.annotation.JsonProperty;
import javax.validation.constraints.NotBlank;

public class Car {

    @NotBlank
    private String name;

    @NotBlank
    private String carNumber;

    @NotBlank
    @JsonProperty("TYPE")   // íŠ¹ì • ë³€ìˆ˜ë¡œ ì œì´ìŠ¨ ë£° ì ìš©.
    private String type;

... getter / setter...

}
```

- User

```java
import javax.validation.Valid;
import java.util.List;

public class User {

.....

    @Valid
    private List<Car> cars;

...getter / setter...

}
```

- JSON Parsing

```json
{
	
	"name" : "ì‹ ì§±êµ¬",
  	"age" : 5,
  	"email" : "zzanggu@dduknyp.vilage",
 	"phoneNumber" : "010-1234-5678",
  	"reqYearMonth" : "2202",
	"cars" : [
		{
			"name" : "K5",
			"carNumber" : "11í˜¸5555",
			"TYPE" : "sedan"
		},
		{
			"name" : "Q5",
			"carNumber" : "55í•˜1111",
			"TYPE" : "SUV" 
		}
	]
}
```

- API Result

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-27 á„‹á…©á„’á…® 4.19.05.png](https://t1.daumcdn.net/cafeattach/1Dzpp/ac99b4fb6983b4bceb63b155572c06bdecc19177)